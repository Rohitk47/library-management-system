<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Reports</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<div class="container mt-4">

  <h3 class="text-center mb-4">ðŸ“Š My Library Report</h3>

  <div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
      <thead class="table-dark text-center">
        <tr>
          <th>Transaction ID</th>
          <th>Book</th>
          <th>Issue Date</th>
          <th>Due Date</th>
          <th>Returned On</th>
          <th>Status</th>
          <th>Fine (â‚¹)</th>
        </tr>
      </thead>

      <tbody>
        <% if (transactions.length === 0) { %>
          <tr>
            <td colspan="7" class="text-center">No records found</td>
          </tr>
        <% } %>

        <% transactions.forEach(t => { %>
          <tr>
            <td class="text-break"><%= t._id %></td>

            <td>
              <strong><%= t.bookId.title %></strong><br>
              <small class="text-muted"><%= t.bookId.author %></small>
            </td>

            <td>
              <%= t.issueDate ? t.issueDate.toDateString() : 'â€”' %>
            </td>

            <td>
              <%= t.returnDate ? t.returnDate.toDateString() : 'â€”' %>
            </td>

            <td>
              <%= t.actualReturnDate ? t.actualReturnDate.toDateString() : 'â€”' %>
            </td>

            <td class="text-center">
              <% if (t.status === 'Pending') { %>
                <span class="badge bg-secondary">Pending</span>
              <% } else if (t.status === 'Issued') { %>
                <span class="badge bg-warning text-dark">Issued</span>
              <% } else if (t.status === 'ReturnRequested') { %>
                <span class="badge bg-info text-dark">Return Requested</span>
              <% } else { %>
                <span class="badge bg-success">Returned</span>
              <% } %>
            </td>

            <td class="text-center <%= t.fine > 0 ? 'text-danger fw-bold' : 'text-success' %>">
              â‚¹ <%= t.fine || 0 %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div class="row mt-4">
    <div class="col-md-4 alert alert-primary">
      Total Transactions: <%= transactions.length %>
    </div>

    <div class="col-md-4 alert alert-warning">
      Active Books:
      <%= transactions.filter(t => t.status === 'Issued').length %>
    </div>

    <div class="col-md-4 alert alert-success">
      Total Fine Paid:
      â‚¹ <%= transactions.reduce((sum, t) => sum + (t.fine || 0), 0) %>
    </div>
  </div>

  <div class="text-center mt-3">
    <a href="/transactions/availability" class="btn btn-secondary">
      â¬… Back to Library
    </a>
  </div>

</div>
</body>
</html>
